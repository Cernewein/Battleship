<!DOCTYPE html>

<html>

    <head>

        <meta charset="utf-8" />

        <title>Battleships</title>
        <script src="https://code.jquery.com/jquery-3.1.1.js"
			  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
			  crossorigin="anonymous"></script>
			  <style type="text/css">
				@font-face {
				    font-family: VB;
				    src: url(vermin_vibes.woff);

				}
			  	h1{
			  		font-family: VB;
			  		font-size: 50px;
			  		text-align: center;
			  		background-color: #222222;
			  		color: red;
			  	}
			  	h2{
			  		font-family: VB;
			  		text-align: center;
			  	}
			  	td {
					height:10px;
					width: 10px;
					text-align: center;
				}
				table {
					width: 45%;
				}
				table, td, th {
					border: 1px solid black;
					border-collapse: collapse;
				}
			  </style>

    </head>

 

    <body>

        <h1>Battleships</h1>
        <h2 id="pseudo"></h2>
        <!--<p><input type="button" value="Embêter le serveur" id="poke" /></p>-->

		 <table  align="left">
		 <tbody id="adversaire">
		 <tr><td colspan=10>Votre adversaire</td></tr>
		  <tr><td></td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td></tr>
		  <tr id="test1"><td>1</td ><td id="test"> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>2</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>3</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>4</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>5</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>6</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>7</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>8</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>9</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>10</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		 </tbody>
		 </table>

		 <table  align="right">
		 <tbody id="joueur" >
		 <tr><td colspan=10>Votre jeu</td></tr>
		  <tr><td></td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td></tr>
		  <tr><td>1</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>2</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>3</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>4</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>5</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>6</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>7</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>8</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>9</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		  <tr><td>10</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
		 </tbody>
		 </table>

		<div align="center">
			<h3>Vos bateaux:</h3>
				<select id="sel_bateau">
				  <option value="5">Porte-avion</option>
				  <option value="4">Croiseur</option>
				  <option value="3">Contre torpilleur</option>
				  <option value="3">Sous-marin</option>
				  <option value="2">Torpilleur</option>
				</select>
		</div>
		<div align="center">
			<h3>L'orientation du bateau</h3>
				<select id="sel_orientation">
				  <option value="H">Horizontale</option>
				  <option value="V">Verticale</option>
				</select>
		</div>
        <script src="/socket.io/socket.io.js"></script>
        <script>

            var socket = io.connect('http://localhost:8080');
            /*socket.on('message', function(message) {
        		alert('Le serveur a un message pour vous : ' + message);
        	})
			$('#poke').click(function () {

                socket.emit('message', 'Salut serveur, ça va ?');

            })*/
            var pseudo = prompt('Quel est votre pseudo ?');

            // Et on l'envoie avec le signal "new_user"

            socket.emit('new_user', pseudo);
            alert('Veuillez placer vos bateaux');
            var nbrBateaux = 0;

            $('td').click(function (event) {
            	//$(event.target).css("background-color", "red");
            	var col = $(this).parent().children().index($(this));
				var row = $(this).parent().parent().children().index($(this).parent());
				var id = event.target.parentNode.parentNode.id;
				var placement = true;
				var val_bateau = $('#sel_bateau').val();
				if (col>=1 && row>=1 && id == 'joueur') {
					if (nbrBateaux<10) {
						socket.emit('placement_bateaux', {"pseudo":pseudo,"id":id,"bateau":val_bateau,"col":col,"row":row});
						nbrBateaux++;
						$("#sel_bateau option[value='"+val_bateau+"']").remove();
					}else{
						placement = false;
						alert("La phase de placement est finie, place à la phase d'attaque");
					}
				}
				else if(id == 'adversaire' && !placement){
					socket.emit('tir',{"pseudo":pseudo,"id":id,"col":col,"row":row});
				}
				
            	//$('#joueur').css("background-color", "red");
            });
            /*$('td').click(function (event) {
            	//$(event.target).css("background-color", "red");
            	var col = $(this).parent().children().index($(this));
				var row = $(this).parent().parent().children().index($(this).parent());
				var id = event.target.parentNode.parentNode.id;
				if (col>=1 && row>=1) {
					socket.emit('cell', {"id":id,"col":col,"row":row});
				}
            	

            	//$('#joueur').css("background-color", "red");
            });*/
            socket.on('welcome',function(message){
            	$('#pseudo').append(message);
            });

            socket.on('retour_placement',function(bateaux){
            	for (var i=0;i<bateaux.length;i++){
            		if (bateaux[i].pseudo == pseudo) {
	            		var id = bateaux[i].id;
		            	var col = bateaux[i].col+1;
		            	var row = bateaux[i].row+1; 
		            	$("#"+id+" tr:nth-child("+row+") td:nth-child("+col+")").css("background-color", 'red');
            		}
            	}
            });

            socket.on('retour_tir',function(tirs){
            	for (var i=0;i<tirs.length;i++){
					var id = tirs[i].id;
	            	var col = tirs[i].col+1;
	            	var row = tirs[i].row+1;
	            	var touche = tirs[i].touche;
	            	$("#"+id+" tr:nth-child("+row+") td:nth-child("+col+")").css("background-color", 'blue');
            	}
            });
        </script>

    </body>

</html>